<!DOCTYPE html>
<html data-bs-theme="light" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Lightspeed ETC</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic&amp;display=swap">
    <link rel="stylesheet" href="assets/css/bss-overrides.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        body { padding: 20px; background-color: #f8f9fa; }
        .section-card { margin-bottom: 20px; }
        .results-section { background-color: #e9ecef; }
        .result-value { color: #dc3545; font-weight: bold; }
        .run-button { background-color: #28a745; border-color: #28a745; }
        .run-button:hover { background-color: #218838; border-color: #1e7e34; }
        .nav-dropdown:hover .dropdown-menu {
            display: block;
        }
        .dropdown-menu {
            margin-top: 0;
        }
        /* Make the hover effect transparent */
        .dropdown-item:hover,
        .dropdown-item:focus {
            background-color: rgba(255, 255, 255, 0.2);
        }
    </style>
</head>

<body>
    <header class="text-center text-white pt-0 mb-0 pb-0 masthead">
        <div class="btn-group bg-black bg-opacity-75 w-100" role="group">
            <a class="btn btn-primary bg-black border-3 border-white" role="button" href="index.html">Lightspeed Home</a>
            <div class="btn-group nav-dropdown" role="group">
                <button class="btn btn-primary bg-black border-3 border-white dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">About</button>
                <ul class="dropdown-menu bg-black">
                    <li><a class="dropdown-item text-white" href="about.html">About</a></li>
                    <li><a class="dropdown-item text-white" href="proto-lightspeed.html">proto-Lightspeed</a></li>
                    <li><a class="dropdown-item text-white" href="lightspeed.html">Lightspeed</a></li>
                </ul>
            </div>
            <a class="btn btn-primary bg-black border-3 border-white" role="button" href="resources.html">Resources</a>
            <a class="btn btn-primary bg-black border-3 border-white" role="button" href="results.html">Results</a>
            <a class="btn btn-primary bg-black border-3 border-white" role="button" href="https://binaries.mit.edu">Burdge Research Group</a>
        </div>
    </header>

    <div class="container-fluid mt-3">
        <h1 class="text-center mb-4">Lightspeed Exposure Time Calculator</h1>
        
        <div class="row">
            <!-- Sensor Properties -->
            <div class="col-md-3">
                <div class="card section-card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">Sensor Properties</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Select Sensor</label>
                            <select class="form-select" id="sensor_name"><option value="">Loading...</option></select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Pixel Size (μm)</label>
                            <input type="number" class="form-control" id="pix_size" step="0.1">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Read Noise (e⁻/pix)</label>
                            <input type="number" class="form-control" id="read_noise" step="0.1">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Dark Current (e⁻/pix/s)</label>
                            <input type="number" class="form-control" id="dark_current" step="0.01">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Quantum Efficiency</label>
                            <input type="text" class="form-control" id="qe" disabled value="ARRAY">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Nonlinearity Scale Factor</label>
                            <input type="text" class="form-control" id="nonlinearity_scaleup" disabled value="ARRAY">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Full Well Capacity</label>
                            <input type="number" class="form-control" id="full_well" step="1000">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Telescope Properties -->
            <div class="col-md-3">
                <div class="card section-card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">Telescope Properties</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Select Telescope</label>
                            <select class="form-select" id="telescope_name"><option value="">Loading...</option></select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Diameter (cm)</label>
                            <input type="number" class="form-control" id="diameter" step="1">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">F/number</label>
                            <input type="number" class="form-control" id="f_number" step="0.1">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Telescope Throughput</label>
                            <input type="number" class="form-control" id="bandpass" step="0.01">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Altitude (m)</label>
                            <input type="number" class="form-control" id="altitude" step="1">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Observing Properties -->
            <div class="col-md-3">
                <div class="card section-card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">Observing Properties</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Exposure Time (s)</label>
                            <input type="number" class="form-control" id="exptime" step="0.001" value="1.0">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Exposures in Stack</label>
                            <input type="number" class="form-control" id="num_exposures" step="1" value="1">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Select Filter</label>
                            <select class="form-select" id="filter"><option value="">Loading...</option></select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Instrument Throughput</label>
                            <input type="text" class="form-control" id="instrument_throughput" step="0.01">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Limiting SNR</label>
                            <input type="number" class="form-control" id="limiting_snr" step="0.1" value="5.0">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Seeing (arcsec)</label>
                            <input type="number" class="form-control" id="seeing" step="0.1" value="0.5">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Object Zenith Angle (deg)</label>
                            <input type="number" class="form-control" id="zo" step="1" value="0">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Lunar Phase (deg)</label>
                            <input type="number" class="form-control" id="alpha" step="1" value="180">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Object-Moon Separation (deg)</label>
                            <input type="number" class="form-control" id="rho" step="1" value="45">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Aperture Radius (pix)</label>
                            <input type="text" class="form-control" id="aper_rad" placeholder="Leave blank for optimal">
                        </div>
                        <button class="btn btn-success w-100 mb-2" id="plotTransButton">Plot Transmission</button>
                        <button class="btn btn-success w-100" id="plotPrecisionButton">Plot Magnitude vs. Precision</button>
                    </div>
                </div>
            </div>

            <!-- General Results -->
            <div class="col-md-3">
                <div class="card section-card results-section">
                    <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">General Results</h5>
                        <button class="btn btn-light btn-sm run-button" id="runGeneralButton">RUN</button>
                    </div>
                    <div class="card-body">
                        <div class="mb-2"><small class="text-muted">Pixel Scale (arcsec/pix)</small><div class="result-value" id="pix_scale">-</div></div>
                        <div class="mb-2"><small class="text-muted">Pivot Wavelength (Å)</small><div class="result-value" id="lambda_pivot">-</div></div>
                        <div class="mb-2"><small class="text-muted">PSF FWHM (arcsec)</small><div class="result-value" id="psf_fwhm">-</div></div>
                        <div class="mb-2"><small class="text-muted">Central Pixel Ensquared Energy (%)</small><div class="result-value" id="central_pix_frac">-</div></div>
                        <div class="mb-2"><small class="text-muted">A_eff at Pivot Wavelength (cm²)</small><div class="result-value" id="eff_area_pivot">-</div></div>
                        <div class="mb-2"><small class="text-muted">Limiting AB magnitude</small><div class="result-value" id="limiting_mag">-</div></div>
                        <div class="mb-2"><small class="text-muted">Saturating AB magnitude</small><div class="result-value" id="saturating_mag">-</div></div>
                        <div class="mb-2"><small class="text-muted">Airmass</small><div class="result-value" id="airmass">-</div></div>
                        <div class="mb-2"><small class="text-muted">Zero Point AB Magnitude (1 e⁻/s)</small><div class="result-value" id="zero_point">-</div></div>
                        <div class="mb-2"><small class="text-muted">t_exp where bkg noise = read noise (s)</small><div class="result-value" id="exptime_turnover">-</div></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Spectrum Observation Section -->
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card section-card">
                    <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Spectrum Observation</h5>
                        <button class="btn btn-light btn-sm run-button" id="runSpectrumButton">RUN</button>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="spectrumType" id="flatSpecRadio" checked>
                                <label class="form-check-label" for="flatSpecRadio">Flat spectrum at AB magnitude:</label>
                                <input type="number" class="form-control mt-1" id="flat_spec_mag" step="0.1" value="20.0">
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="spectrumType" id="bbSpecRadio">
                                <label class="form-check-label" for="bbSpecRadio">Blackbody Spectrum</label>
                            </div>
                            <div class="ms-4 mt-2">
                                <label class="form-label">Temperature (K)</label>
                                <input type="number" class="form-control mb-2" id="bb_temp" step="100">
                                <label class="form-label">Distance (Mpc)</label>
                                <input type="number" class="form-control mb-2" id="bb_distance" step="0.1">
                                <label class="form-label">Bolometric Luminosity (erg/s)</label>
                                <input type="number" class="form-control" id="bb_lbol" step="1e36">
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="spectrumType" id="userSpecRadio">
                                <label class="form-check-label" for="userSpecRadio">Custom spectrum name from spectra.py:</label>
                                <input type="text" class="form-control mt-1" id="user_spec_name" placeholder="e.g., my_spectrum">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Spectrum Results -->
            <div class="col-md-6">
                <div class="card section-card results-section">
                    <div class="card-header bg-info text-white"><h5 class="mb-0">Spectrum Results</h5></div>
                    <div class="card-body">
                        <div class="mb-2"><small class="text-muted">Signal (e⁻)</small><div class="result-value" id="signal">-</div></div>
                        <div class="mb-2"><small class="text-muted">Total Noise (e⁻)</small><div class="result-value" id="tot_noise">-</div></div>
                        <div class="mb-2"><small class="text-muted">SNR</small><div class="result-value" id="snr">-</div></div>
                        <div class="mb-2"><small class="text-muted">Photometric Precision (ppm)</small><div class="result-value" id="phot_prec">-</div></div>
                        <div class="mb-2"><small class="text-muted">Aperture Size (pix)</small><div class="result-value" id="n_aper">-</div></div>
                        <div class="mb-2"><small class="text-muted">Noise Breakdown</small><div class="result-value" style="font-size: 0.9em; white-space: pre-line;" id="noise_breakdown">-</div></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Transmission Plot -->
    <div class="modal fade" id="transmissionModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">System Transmission</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body"><div id="transmissionPlot" style="width:100%;height:600px;"></div></div>
            </div>
        </div>
    </div>

    <!-- Modal for Precision Plot -->
    <div class="modal fade" id="precisionModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Photometric Precision vs. Magnitude</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body"><div id="precisionPlot" style="width:100%;height:600px;"></div></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_URL = 'https://hypernova.mit.edu/etc-api';
        // const API_URL = 'http://localhost:8080';

        async function loadAvailableOptions() {
            try {
                const sensorsResponse = await fetch(`${API_URL}/get_available_sensors`);
                const sensorsData = await sensorsResponse.json();
                const sensorSelect = document.getElementById('sensor_name');
                sensorSelect.innerHTML = '';
                sensorsData.sensors.forEach(sensor => {
                    const option = document.createElement('option');
                    option.value = sensor;
                    option.textContent = sensor;
                    sensorSelect.appendChild(option);
                });
                sensorSelect.value = 'ORCA-Quest 2';

                const telescopesResponse = await fetch(`${API_URL}/get_available_telescopes`);
                const telescopesData = await telescopesResponse.json();
                const telescopeSelect = document.getElementById('telescope_name');
                telescopeSelect.innerHTML = '';
                telescopesData.telescopes.forEach(telescope => {
                    const option = document.createElement('option');
                    option.value = telescope;
                    option.textContent = telescope;
                    telescopeSelect.appendChild(option);
                });
                telescopeSelect.value = 'Clay (proto-Lightspeed)';

                const filtersResponse = await fetch(`${API_URL}/get_available_filters`);
                const filtersData = await filtersResponse.json();
                const filterSelect = document.getElementById('filter');
                filterSelect.innerHTML = '';
                filtersData.filters.forEach(filter => {
                    const option = document.createElement('option');
                    option.value = filter;
                    option.textContent = filter;
                    filterSelect.appendChild(option);
                });
                filterSelect.value = "Baader g'";

                await updateSensorFields();
                await updateTelescopeFields();
            } catch (error) {
                console.error('Error loading options:', error);
                alert('Could not load instrument options from server. Make sure the backend is running.');
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadAvailableOptions();
        });

        document.getElementById('sensor_name').addEventListener('change', updateSensorFields);
        document.getElementById('telescope_name').addEventListener('change', updateTelescopeFields);

        async function updateSensorFields() {
            const sensorName = document.getElementById('sensor_name').value;
            try {
                const response = await fetch(`${API_URL}/get_sensor_info/${encodeURIComponent(sensorName)}`);
                const data = await response.json();
                document.getElementById('pix_size').value = data.pix_size;
                document.getElementById('read_noise').value = data.read_noise;
                document.getElementById('dark_current').value = data.dark_current;
                document.getElementById('full_well').value = data.full_well;
            } catch (error) {
                console.error('Error fetching sensor info:', error);
            }
        }

        async function updateTelescopeFields() {
            const telescopeName = document.getElementById('telescope_name').value;
            try {
                const response = await fetch(`${API_URL}/get_telescope_info/${encodeURIComponent(telescopeName)}`);
                const data = await response.json();
                document.getElementById('diameter').value = data.diam;
                document.getElementById('f_number').value = data.f_num;
                document.getElementById('bandpass').value = data.bandpass;
                document.getElementById('altitude').value = data.altitude;
                
                // Update instrument throughput field
                const throughputField = document.getElementById('instrument_throughput');
                throughputField.value = data.instrument_throughput;
                throughputField.disabled = data.has_array_throughput;
            } catch (error) {
                console.error('Error fetching telescope info:', error);
            }
        }

        function getFormData() {
            return {
                sensor_name: document.getElementById('sensor_name').value,
                pix_size: parseFloat(document.getElementById('pix_size').value),
                read_noise: parseFloat(document.getElementById('read_noise').value),
                dark_current: parseFloat(document.getElementById('dark_current').value),
                full_well: parseFloat(document.getElementById('full_well').value),
                telescope_name: document.getElementById('telescope_name').value,
                diameter: parseFloat(document.getElementById('diameter').value),
                f_number: parseFloat(document.getElementById('f_number').value),
                bandpass: parseFloat(document.getElementById('bandpass').value),
                altitude: parseFloat(document.getElementById('altitude').value),
                exptime: parseFloat(document.getElementById('exptime').value),
                num_exposures: parseInt(document.getElementById('num_exposures').value),
                filter: document.getElementById('filter').value,
                instrument_throughput: document.getElementById('instrument_throughput').value,
                limiting_snr: parseFloat(document.getElementById('limiting_snr').value),
                seeing: parseFloat(document.getElementById('seeing').value),
                zo: parseFloat(document.getElementById('zo').value),
                alpha: parseFloat(document.getElementById('alpha').value),
                rho: parseFloat(document.getElementById('rho').value),
                aper_rad: document.getElementById('aper_rad').value || null
            };
        }

        document.getElementById('runGeneralButton').addEventListener('click', async function() {
            try {
                const response = await fetch(`${API_URL}/calculate_general`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(getFormData())
                });
                if (!response.ok) {
                    const error = await response.json();
                    alert('Error: ' + error.detail);
                    return;
                }
                const results = await response.json();
                document.getElementById('pix_scale').textContent = results.pix_scale.toFixed(3);
                document.getElementById('lambda_pivot').textContent = results.lambda_pivot.toFixed(0);
                document.getElementById('psf_fwhm').textContent = results.psf_fwhm.toFixed(3);
                document.getElementById('central_pix_frac').textContent = results.central_pix_frac.toFixed(3);
                document.getElementById('eff_area_pivot').textContent = results.eff_area_pivot.toFixed(0);
                document.getElementById('limiting_mag').textContent = results.limiting_mag.toFixed(3);
                document.getElementById('saturating_mag').textContent = results.saturating_mag.toFixed(3);
                document.getElementById('airmass').textContent = results.airmass.toFixed(3);
                document.getElementById('zero_point').textContent = results.zero_point.toFixed(3);
                document.getElementById('exptime_turnover').textContent = results.exptime_turnover.toFixed(3);
            } catch (error) {
                alert('Error: ' + error.message);
            }
        });

        document.getElementById('runSpectrumButton').addEventListener('click', async function() {
            let spectrumType, spectrumParams = {};
            if (document.getElementById('flatSpecRadio').checked) {
                spectrumType = 'flat';
                spectrumParams.ab_mag = parseFloat(document.getElementById('flat_spec_mag').value);
            } else if (document.getElementById('bbSpecRadio').checked) {
                spectrumType = 'blackbody';
                spectrumParams.temperature = parseFloat(document.getElementById('bb_temp').value);
                spectrumParams.distance = parseFloat(document.getElementById('bb_distance').value);
                spectrumParams.luminosity = parseFloat(document.getElementById('bb_lbol').value);
            } else if (document.getElementById('userSpecRadio').checked) {
                spectrumType = 'user';
                spectrumParams.name = document.getElementById('user_spec_name').value;
            }

            const formData = getFormData();
            formData.spectrum_type = spectrumType;
            formData.spectrum_params = spectrumParams;

            try {
                const response = await fetch(`${API_URL}/calculate_spectrum`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(formData)
                });
                if (!response.ok) {
                    const error = await response.json();
                    alert('Error: ' + error.detail);
                    return;
                }
                const results = await response.json();
                document.getElementById('signal').textContent = results.signal.toFixed(2);
                document.getElementById('tot_noise').textContent = results.tot_noise.toFixed(2);
                document.getElementById('snr').textContent = results.snr.toFixed(3);
                document.getElementById('phot_prec').textContent = results.phot_prec.toFixed(3);
                document.getElementById('n_aper').textContent = results.n_aper;
                document.getElementById('noise_breakdown').textContent = 
                    `Shot noise: ${results.shot_noise.toFixed(2)}\nDark noise: ${results.dark_noise.toFixed(2)}\nRead noise: ${results.read_noise.toFixed(2)}\nBackground noise: ${results.bkg_noise.toFixed(2)}\nScintillation noise: ${results.scint_noise.toFixed(2)}`;
            } catch (error) {
                alert('Error: ' + error.message);
            }
        });

        document.getElementById('plotTransButton').addEventListener('click', async function() {
            const formData = {
                sensor_name: document.getElementById('sensor_name').value,
                telescope_name: document.getElementById('telescope_name').value,
                filter: document.getElementById('filter').value,
                instrument_throughput: document.getElementById('instrument_throughput').value,
                zo: parseFloat(document.getElementById('zo').value),
                altitude: parseFloat(document.getElementById('altitude').value)
            };

            try {
                const response = await fetch(`${API_URL}/plot_transmission`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(formData)
                });
                if (!response.ok) {
                    const error = await response.json();
                    alert('Error: ' + error.detail);
                    return;
                }
                const plotData = await response.json();
                const traces = plotData.traces.map(trace => ({
                    x: trace.wavelength,
                    y: trace.transmission,
                    name: trace.name,
                    mode: 'lines',
                    line: {
                        dash: trace.linestyle === '--' ? 'dash' : trace.linestyle === ':' ? 'dot' : trace.linestyle === '-.' ? 'dashdot' : 'solid',
                        width: trace.linestyle === '-' ? 2 : 1.5
                    }
                }));
                Plotly.newPlot('transmissionPlot', traces, {
                    title: 'System Transmission',
                    xaxis: { title: 'Wavelength (nm)' },
                    yaxis: { title: 'Transmission (%)' },
                    showlegend: true,
                    legend: { x: 0.7, y: 0.95 }
                });
                new bootstrap.Modal(document.getElementById('transmissionModal')).show();
            } catch (error) {
                alert('Error: ' + error.message);
            }
        });

        document.getElementById('plotPrecisionButton').addEventListener('click', async function() {
            try {
                const response = await fetch(`${API_URL}/plot_mag_vs_precision`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(getFormData())
                });
                if (!response.ok) {
                    const error = await response.json();
                    alert('Error: ' + error.detail);
                    return;
                }
                const plotData = await response.json();
                const traces = [
                    { x: plotData.magnitudes, y: plotData.total_noise, name: 'Total Noise', mode: 'lines', line: { width: 2.5 } },
                    { x: plotData.magnitudes, y: plotData.shot_noise, name: 'Shot Noise', mode: 'lines', line: { width: 2 } },
                    { x: plotData.magnitudes, y: plotData.read_noise, name: 'Read Noise', mode: 'lines', line: { width: 2 } },
                    { x: plotData.magnitudes, y: plotData.bkg_noise, name: 'Background Noise', mode: 'lines', line: { width: 2 } },
                    { x: plotData.magnitudes, y: plotData.dark_noise, name: 'Dark Current Noise', mode: 'lines', line: { width: 2 } },
                    { x: plotData.magnitudes, y: plotData.scint_noise, name: 'Scintillation Noise', mode: 'lines', line: { width: 2 } },
                    { x: [10, 28, 28, 10], y: [plotData.limiting_threshold, plotData.limiting_threshold, 2e6, 2e6], fill: 'toself', fillcolor: 'rgba(255, 0, 0, 0.1)', line: { width: 0 }, name: 'Non-detection', showlegend: true, hoverinfo: 'skip' }
                ];
                Plotly.newPlot('precisionPlot', traces, {
                    title: plotData.title,
                    xaxis: { title: 'AB Magnitude', range: [10, 28] },
                    yaxis: { title: 'Photometric Precision (ppm)', type: 'log', range: [0, 6.3] },
                    showlegend: true,
                    legend: { x: 0.02, y: 0.98 }
                });
                new bootstrap.Modal(document.getElementById('precisionModal')).show();
            } catch (error) {
                alert('Error: ' + error.message);
            }
        });
    </script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
</body>
</html>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
</body>

</html>